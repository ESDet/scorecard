.stat-region
  .header What percent of the students are <u>ready</u> for college?
  .content
    .container_12
      .visual
        - if @school.math_ready_average
          %div(id="math-ready")
        - if @school.reading_ready_average
          %div.hide(id="reading-ready")
        - if @school.science_ready_average
          %div.hide(id="science-ready")
        - if @school.english_ready_average
          %div.hide(id="english-ready")
      .subjects
        - if @school.math_ready_average
          .subject.active(data-target="math-ready")
            .title Math
        - if @school.reading_ready_average
          .subject(data-target="reading-ready")
            .title Reading
        - if @school.science_ready_average
          .subject(data-target="science-ready")
            .title Science
        - if @school.english_ready_average
          .subject(data-target="english-ready")
            .title English
    .links
      .compare(style="color: #bde35f") School Average
      .compare(style="color: #ec5932") Detroit Average
      .compare(style="color: #14b2ae") State Average
      .message
        .act-icon
        Results based on ACT scores
.stat-region
  .header How do the students test scores <u>grow</u> over time compared to state averages?
  .content
    .visual
      %div(id="math-growth")
        = render 'subject_growth', growth: @school.math_growth_average
      %div.hide(id="reading-growth")
        = render 'subject_growth', growth: @school.reading_growth_average
      %div.hide(id="science-growth")
        = render 'subject_growth', growth: @school.science_growth_average
      %div.hide(id="english-growth")
        = render 'subject_growth', growth: @school.english_growth_average
    .subjects
      .subject.active(data-target="math-growth")
        .title Math
      .subject(data-target="reading-growth")
        .title Reading
      .subject(data-target="science-growth")
        .title Science
      .subject(data-target="english-growth")
        .title English
    .links
      .message
        .act-icon
        Results based on ACT scores
.stat-region.three-columns
  .header What percent of students <u>graduate</u> and go to <u>college</u>?
  .content
    .visual
      %div.bar-graph(id="graduate")
      %div.bar-graph.hide(id="enroll")
      %div.bar-graph.hide(id="college")
    .subjects
      .subject.active(data-target="graduate")
        .title Graduate on time
      .subject(data-target="enroll")
        .title Enroll in college
      .subject(data-target="college")
        .title Finish 1st year of college
    .links
      .compare
        .compare-arrow-icon
        <span>Compare</span> to <span>Detroit</span> averages
      .compare
        .compare-arrow-icon
        <span>Compare</span> to <span>State</span> averages


:javascript
  $(document).ready(function(e) {
    var drawDonut = function(element, data) {
      var w = 200,
        h = 200,
        r = Math.max(w, h) / 2,
        labelr = r + 20,
        color = d3.scale.category20(),
        donut = d3.scale.linear().domain([0, 100]).range([0, 2 * Math.PI]),
        arc = d3.svg.arc()
          .innerRadius(function(d) { return d.innerRadius; })
          .outerRadius(function(d) { return d.outerRadius; })
          .startAngle(function(d) { return donut(d.start); })
          .endAngle(function(d) { return donut(d.end); });

      var vis = d3.select(element)
        .append("svg:svg")
        .attr("width", w + 30)
        .attr("height", h + 30);

      var arcs = vis.selectAll("path")
        .data(data)
        .enter()
        .append("path")
        .attr("d", arc)
        .style("fill", function(d) { return d.color; })
        .attr("transform", "translate(" + (r + 10) + "," + (r + 10) + ")");

      vis.selectAll("text")
        .data(data)
        .enter()
        .append("text")
        .attr("font-size", "12px")
        .attr("transform", function(d) {
          return "translate(" + (60 + d.outerRadius) +  ',' + (100 - d.innerRadius) +  ")";
        })
        .text(function(d) { return d.label; });
    };

    var donutOpts = function(label, color, start, end, outer, inner) {
      return {
        label: label,
        color: color,
        start: start,
        end: end,
        outerRadius: outer,
        innerRadius: inner
      };
    };

    drawDonut("#math-ready", [
      donutOpts("#{@school.math_ready_average}%", "#bde35f", 0, #{@school.math_ready_average}, 100, 75),
      donutOpts("#{@school.detroit_math_ready_average}%", "#ec5932", 0, #{@school.detroit_math_ready_average}, 75, 50),
      donutOpts("#{@school.state_math_ready_average}%", "#14b2ae", 0, #{@school.state_math_ready_average}, 50, 25)
    ]);

    drawDonut("#reading-ready", [
      donutOpts("#{@school.reading_ready_average}%", "#bde35f", 0, #{@school.reading_ready_average}, 100, 75),
      donutOpts("#{@school.detroit_reading_ready_average}%", "#ec5932", 0, #{@school.detroit_reading_ready_average}, 75, 50),
      donutOpts("#{@school.state_reading_ready_average}%", "#14b2ae", 0, #{@school.state_reading_ready_average}, 50, 25)
    ]);

    drawDonut("#science-ready", [
      donutOpts("#{@school.science_ready_average}%", "#bde35f", 0, #{@school.science_ready_average}, 100, 75),
      donutOpts("#{@school.detroit_science_ready_average}%", "#ec5932", 0, #{@school.detroit_science_ready_average}, 75, 50),
      donutOpts("#{@school.state_science_ready_average}%", "#14b2ae", 0, #{@school.state_science_ready_average}, 50, 25)
    ]);

    drawDonut("#english-ready", [
      donutOpts("#{@school.english_ready_average}%", "#bde35f", 0, #{@school.english_ready_average}, 100, 75),
      donutOpts("#{@school.detroit_english_ready_average}%", "#ec5932", 0, #{@school.detroit_english_ready_average}, 75, 50),
      donutOpts("#{@school.state_english_ready_average}%", "#14b2ae", 0, #{@school.state_english_ready_average}, 50, 25)
    ]);

    var drawBar = function(element, data) {
      var margin = {top: 20, left: 40},
          width = 80,
          height = 200;

      var x = d3.scale.ordinal()
        .rangeRoundBands([0, width], .05);

      var y = d3.scale.linear().range([height, 0]);

      var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom")

      var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left")

      var svg = d3.select(element).append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .attr("transform",
          "translate(" + 0 + "," + 0 + ")");

      y.domain([0, d3.max(data, function(d) {
        return d.value;
      })]);

      svg.selectAll("bar")
        .data(data)
        .enter()
        .append("rect")
        .style("fill", function(d) { return d.color; })
        .attr("width", width)
        .attr("y", function(d) { return y(d.value); })
        .attr("height", function(d) {
          return height - y(d.value);
        });

      svg.selectAll("text")
        .data(data)
        .enter()
        .append("text")
        .attr("font-size", "12px")
        .attr("x", function(d) { return 25 })
        .attr("y", function(d) { return y(d.value); })
        .text(function(d, i) { return d.label; });
    };

    var barOpts = function(label, color, value) {
      return {
        label: label,
        color: color,
        value: value
      };
    };

    drawBar('#graduate', [
      barOpts("", '#fff', 100),
      barOpts("#{@school.high_school_graduate_average}%", '#bde35f', #{@school.high_school_graduate_average})
    ]);

    drawBar('#enroll', [
      barOpts("", '#fff', 100),
      barOpts("#{@school.enroll_in_college_average}%", '#bde35f', #{@school.enroll_in_college_average})
    ]);

    drawBar('#college', [
      barOpts("", '#fff', 100),
      barOpts("#{@school.finish_some_college_average}%", '#bde35f', #{@school.finish_some_college_average})
    ]);
  });
