#outer_wrapper
  #lefty
    %h2= @title

    %p.count
    = render :partial => 'shared/filters'
    .clear_floats
    %br/
    
    %ul.school_list
      - @schools.each do |s|
        = render 'item', { :school => s }


  = render 'shared/map', :object => @map


:javascript
  var listSpinner = null;
  var searching = false;
  $(document).ready(function(e) {
    $('.l-footer-wrapper').hide();
    
    $('form.search').submit(function(e) {
      // Get ajax for da new search and update list
      if(searching) {
        return false;
      }
      searching = true;
      var data = {
        filter: $('#filter', this).val(),
        type: $('#type', this).val(),
        loc: $('#loc', this).val()
      };
      if(!listSpinner) {
        listSpinner = new Spinner({zIndex: 4000});
      }
      listSpinner.spin($('#lefty').get(0));

      $.ajax({
        async: true,
        type: 'GET',
        url: '/schools.json',
        data: data,
        cache: false,
        success: function(response) {
          if(false) {
            map.map.removeLayer(map.overlays.schools);
            map.overlays.schools = map.addLayer(Paraffin.GEOJSON, { object: response });
              //options: { style: { color: '#909', opacity: 1, weight: 3, fillOpacity: 0, fillColor: 'none' } } });
          } else {
            for(var i in map.overlays.schools._layers) {
              var dot = map.overlays.schools._layers[i];
              map.overlays.schools.removeLayer(dot);
            }
            map.overlays.schools.addData(response);
          }
          var template = "{{#features}}{{#properties}}<li><a href='/schools/{{slug}}'>{{name}}</a><br/>{{address}}<br/>Grades {{grades_served}}</li>{{/properties}}{{/features}}";
          var html = Mustache.to_html(template, response);
          $('.school_list').html(html);
          listSpinner.stop();
          searching = false;
        },
        error: function(response) { }
      });
         
      return false;
    });
  });