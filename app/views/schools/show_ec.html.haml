- cache(@school.cache_key, condition: @school.can_cache?) do
  .summary.earlychild
    .middle
      .container_12
        .grid_12{:style => 'margin-bottom: 1em;'}
          %br/
          %h2= @school.name
          %a.address{:href => @school.gmaps_url, :target => '_blank'} #{raw @school.street}
          .noprint
            - if @school.school_url
              %a.external{:href => @school.school_url, :target => '_blank'}
                = image_tag 'external.png'
                School Website
            - if @school.facebook_url
              %a.external{:href => @school.facebook_url, :target => '_blank'}
                = image_tag 'external.png'
                Facebook

      .container_12
        .grid_3.overall-seal
          = render 'seal', :category => :overall, :rating => @school.andand.overall_rating, :school => @school

        .grid_3.hours
          %h3 Hours
          .arial
            - num = 0
            - ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'].each do |day|
              - next if @school[(day + '_open').to_sym].blank? or @school[(day + 'day_close').to_sym].blank?
              - num += 1
              %span.day #{day.titleize}:
              #{@school[(day + 'day_open').to_sym]} &mdash; #{@school[(day + 'day_close').to_sym]}
              %br/
            - if num == 0
              No hours of operation listed.
            %p
              %span.day Months of operation:
              #{@school.months_of_operation}
            %p
              - unless @school.contact.blank?
                %span.day Contact person:
                #{@school.contact}
                %br/
              - unless @school.email.blank?
                %span.day Email:
                #{@school.email}
                %br/
              - unless @school.phone.blank?
                %span.day Phone:
                #{format_phone(@school.phone)}
          %h3 Share
          = render 'shared/share'


        .grid_4.map-container
          #map


      %br.noprint/
      %br.noprint/

      #ground-wrapper
        #ground
        .container_12.clear_floats.details.earlychild
          %ul.nav.nav-tabs
            %li{:class => 'active'}
              %a{:href => '#overview', 'data-toggle' => 'tab'}
                .question.bebas
                  %span.nomobile About This School
                  %span.mobile_only About
                = render 'seal', :category => :overview, :rating => nil, :school => @school
            %li
              %a{:href => '#community', 'data-toggle' => 'tab'}
                .question.bebas
                  %span.nomobile What does the community think?
                  %span.mobile_only Community's Rating
                = render 'seal', :category => :community, :rating => @school.andand.overall_site_visit_rating, :school => @school
            %li{:class => ''}
              %a{:href => '#state', 'data-toggle' => 'tab'}
                .question.bebas
                  %span.nomobile What does the state think?
                  %span.mobile_only State's Rating
                = render 'seal', :category => :state, :rating => @school.andand.sas_score_rating, :school => @school
            %li
              %a{:href => '#staff', 'data-toggle' => 'tab'}
                .question.bebas
                  %span.nomobile What does the staff think?
                  %span.mobile_only Staff's Rating
                = render 'seal', :category => :staff, :rating => @school.andand.teacher_survey_rating, :school => @school

          .tab-content
            #overview.tab-pane.self_reported{:class => 'active'}
              /= render 'shared/tip', :tip => @tips[:ec_profile]
              - if @school.nil?
                %p.orange
                  This program doesn't have an overall rating from Excellent Schools Detroit because it did not participate in the community and staff surveys.

              - if @school.andand.gscmessage
                %p= raw @school.gscmessage

              %table
                /- @profile_fields.each do |field,label|
                /  - val = @schoolh[field.to_sym]
                /  - unless val.blank?
                /    %tr
                /      %td
                /        %h3 #{label}:
                /      %td.arial
                /        - if [:agefrom, :ageto].include? field
                /          - if val.to_i > 11
                /            #{(val.to_i/12).to_i} years,
                /          #{val.to_i%12} months
                /        - else
                /          = raw((val == '0') ? 'No' : (val == '1' ? 'Yes' : val))

              = render 'legend', :school => @school, :tab => :overall

            #community.tab-pane
              %p.turquoise
                The Community rating is based on surveys conducted on-site at the program by a group of trained reviewers from the community.
                After spending four hours observing and taking notes, reviewers answer questions on a four-point scale that measures how much they
                agree with the statements below (I do not agree at all, I somewhat agree, I mostly agree, and I completely agree). A score
                of 4.0 out of 4.0 is considered an "excellent" rating.

              - if @school
                .community_line
                  %div
                    %h3.score
                      %span.points= @school.community_clc_fair_average.round(1)
                      %span / 4.0
                    %h3.statement Cultural Awareness
                    .explanation.arial The rating is based on how well teachers showed respect to all children regardless of race, culture and ability.

                  %div.clear_floats
                    %h3.score
                      %span.points= @school.community_professionalism_fair_average.round(1)
                      %span / 4.0
                    %h3.statement Professionalism
                    .explanation.arial The rating is based on how teachers and staff behave and treat each other while in the room with children.

                  %div.clear_floats
                    %h3.score
                      %span.points= @school.community_safety_fair_average.round(1)
                      %span / 4.0
                    %h3.statement Program Environment
                    .explanation.arial This rating is based on the conditions of the classroom.

                  %div.clear_floats
                    %h3.score
                      %span.points= @school.community_interactions_fair_average.round(1)
                      %span / 4.0
                    %h3.statement Relationships & Interactions
                    .explanation.arial The rating is based on how well teachers manage the classroom.

                  %div.clear_floats
                    %h3.score
                      %span.points= @school.community_family_fair_average.round(1)
                      %span / 4.0
                    %h3.statement Collaboration
                    .explanation.arial The rating is based on how the family, community and school work together.

              = render 'legend', school: @school, :tab => :community


            #state.tab-pane{:class => ''}
              %p.turquoise
                The following star ratings are from Great Start to Quality's 5-Star Quality Rating and Improvement System (QRIS),
                which is a state-run program. The points in each category are from the program's self-assessment.

              .overall-stars.relative
                = image_tag 'el_icons/gs_logo.png', :class => 'gs-logo'
                = render 'stars', :n => [@school.published_rating.to_i, 0].max
              %table
                %thead
                  %tr
                    %th
                      %span.points= @school.points_total
                      %span / 50
                    %th Overall Score
                %tbody
                  %tr
                    %td
                      %span.points= @school.points_staff
                      %span / 16
                    %td Staff Qualifications and Professional Development
                  %tr
                    %td
                      %span.points= @school.points_family
                      %span / 8
                    %td Family and Community Partnerships
                  %tr
                    %td
                      %span.points= @school.points_admin
                      %span / 6
                    %td Administration and Management
                  %tr
                    %td
                      %span.points= @school.points_curriculum
                      %span / 12
                    %td Curriculum and Instruction

              %br/
              %h3 Here is what the star ratings mean:
              %div
                = render 'stars', :n => 0
                Program meets state licensing requirements
              %div
                = render 'stars', :n => 1
                Program meets state licensing requirements and is participating in Great Start to Quality
              %div
                = render 'stars', :n => 2
                Program demonstrates quality across some standards
              %div
                = render 'stars', :n => 3
                Program demonstrates quality across several standards
              %div
                = render 'stars', :n => 4
                Program demonstrates quality across almost all standards
              %div
                = render 'stars', :n => 5
                Program demonstrates highest quality

              = render 'legend', school: @school, :tab => :state

            #staff.tab-pane
              %p.turquoise
                Teachers and staff here were asked to complete  a survey about their program. The survey
                included items about community engagement, family engagement, cultural and linguistic competence,
                and climate and culture. Teachers and staff answered questions on a four-point scale. Those answers
                were then averaged to create the number below.

              %hr
              %br/

              - if @school.teacher_score_mean
                = render 'staff_rating', :score => @school.teacher_score_mean, :state => 3.64

              = render 'legend', school: @school, :tab => :staff


        %br/
        %br/

      :javascript
        $(document).ready(function(e) {
          Map({
            center: #{@school.center.to_json},
            markers: #{[@school.marker].to_json},
            zoom: 15,
            zoomControl: false,
            dragging: false,
            touchZoom: false,
            scrollWheelZoom: false,
            doubleClickZoom: false,
            boxZoom: false,
            tap: false,
            keyboard: false
          });

          $('.region-title').click(function() {
            var me = $(this);
            var target = $('#' + me.data('target'));
            if (target.hasClass('hide')) {
              me.removeClass('closed');
              target.removeClass('hide');
            } else {
              me.addClass('closed');
              target.addClass('hide');
            }
          });
        });
